<!DOCTYPE html>
<html>

  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,900" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="suntimes.css">
    <title>IFTTT Sunrise/Sunset Event Generator</title>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-t0PKWwRk8S6-mxpe-0UAXLBBHyXUfLE">
    </script>

    <script src="suntimes-client.js"></script>
  </head>
  <body>


    <div id="wrapper">
        <div class="title">IFTTT Sunrise/Sunset Event Generator</div>
        <div id="content">


        <div id="key-group">

          <div class="group maker-intro">Maker Key:</div>
          <form class="group form-text">
            <input id="key-input" type="text"></input>
          </form>
          <button class="group" id="key-lookup-button">Lookup</button>


        </div>
        <div id="key-exists">

          <div id="sunrise-group">
            <div class="group sun-intro">Next sunrise is:</div>
            <div class="group time-text" id="sunrise"></div>
            <button class="group" id="test-sunrise-button">Test</button>
          </div>

          <div id="sunset-group">
            <div class="group sun-intro">Next sunset is:</div>
            <div class="group time-text" id="sunset"></div>
            <button class="group" id="test-sunset-button">Test</button>
          </div>

          <div id="change-location-group">
            <button class="group" id="change-location-button">Change Location</button>
          </div>


        </div>

        <div id="no-key">
          <div  class="group maker-intro" id="postcode">UK Postcode:</div>
          <form class="group form-text">
            <input id="postcode-input" type="text"></input>
          </form>
          <button class="group" id="postcode-button">Add</button>
        </div>


      </div>




      <div id="sidebar">

      </div>
      <div id="cleared"></div>
    </div>

    <div id="wrapper2">
      <div id="map"></div>
      <div id="location"></div>
      <div id="link-group">
        <div class="group smaller">Permalink: </div>
        <div class="group smaller" id="permalink"></div>
      </div>
      <div id="help">Click for Help</div>
      <div id="help-panel">
        <h3>How to connect:</h3>
        <ol>
          <li>Go to <a href="https://ifttt.com/maker" target="_blank">IFTTT Maker</a> and connect it to your IFTTT account</li>
          <li>Click the 'settings' cog in the top right of the maker screen</li>
          <li>Make a note of your 'Maker Key'.  The maker key is the text in the URL part of the screen.  You only need the last bit.  So for example if the URL is:  <pre>https://maker.ifttt.com/use/xyZvZHbPdm3zVOjip5H99a</pre> then the maker id is: <pre>xyZvZHbPdm3zVOjip5H99a</pre></li>
          <li>Create two Maker applets in IFTTT.  The first one should have an (all lower case) event name of: <pre>sunrise</pre>  The second should have an event name of:<pre>sunset</pre> Wire them up to trigger whatever, for e.g. turn on a light at sunset.</li>
          <li>Put the Maker Key into the box above</li>
          <li>Enter your UK postcode</li>
          <li>Test the events are wired up correctly by clicking the 'Test' buttons.  If everything is wired up correctly then the tests will pass and IFTTT things will happen such as a light will turn on.</li>
          <li>Wait!</li>
        </ol>
        <h3>Why?</h3>
        <ul>
          <li>The default IFTTT sunrise/sunset trigger provided by Weather Underground can be delayed by up to one hour.</li>
          <li>This app is accurate to within a minute of local sunrise/sunset times.</li>
          <li>Just because I wanted to have a play.</li>
        </ul>
        <h3>Possible issues</h3>
        <ul>
          <li>Not tested outside the UK because I couldn't get my head round timezones just yet. Also, I have no idea if it will work when the clocks change!</li>
          <li>If you accidentally regenerate your IFTTT Maker Key by clicking on the 'edit connection' button then the old Maker Key still seems to work but with a 20-30 minute delay.</li>
          <li>If you are any way concerned then leave the Weather Underground triggered IFTTT applets as backstops as it doesn't matter if your light gets told to turn off twice.</li>
        </ul>
      </div>
      <div id="credit">Built by <a href="https://twitter.com/simon_greig" target="_blank">@simon_greig</a></div>

    </div>



  </body>
</html>
